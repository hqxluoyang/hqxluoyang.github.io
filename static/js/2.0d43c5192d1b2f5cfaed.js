webpackJsonp([2],{"0rgg":function(t,e,i){"use strict";(function(t){var s=i("Xxa5"),a=i.n(s),n=i("exGp"),r=i.n(n),o=i("YHW8"),l=i("mHVC"),c=i("jxKr");e.a={name:"history_video_list",components:{VodPlayer:o.a,autocomplete:l.a,QueryFilter:c.a},data:function(){return{history_video_url_prefix:null,tableData:[],playerOptions:{},loading:!0,current_page:0,offset:0,limit:8,total:0,currentIndex:0,currentRow:{},deleteConfirmVisible:!1,showVideo:!1,inputValue:[],where:null}},methods:{closePlay:function(){t("#player").stop(),this.currentRow=null},handlePlay:function(t,e){this.currentRow=e,this.showVideo=!0},confirmDelete:function(t,e){var i=this;this.currentIndex=t,this.currentRow=e,this.$confirm("确认删除该视频吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){i.deleteVideo()})},deleteVideo:function(){var t=this;this.$log.debug("handle delete file "+this.currentRow.file_name),this.axios.delete("/vod/delete/"+this.currentRow.id).then(function(e){if(t.loading=!1,0==e.data.ret.code){var i=t.tableData.indexOf(t.currentRow);t.tableData.splice(i,1),t.$message.success("历史视频删除成功"),t.fetchData(t.where)}else t.$message.error("历史视频删除失败, 原因:"+t.apiErrorMessage(e))}),this.deleteConfirmVisible=!1},fetchData:function(t){var e=this;this.where=t,this.loading=!0,this.axios.post("/v2/vod/list/"+this.offset+"/"+this.limit+"?device_type=rtc",this.where).then(function(t){if(e.loading=!1,e.inputValue=[],0==t.data.ret.code){e.total=t.data.total;var i=e.baseUrl.protocol,s=e.baseUrl.host,a="";e.$log.debug("vod url prefix ",t.data.vod_url_prefix),t.data.vod_url_prefix&&(t.data.vod_url_prefix.protocol&&t.data.vod_url_prefix.protocol.length>1&&(i=t.data.vod_url_prefix.protocol),t.data.vod_url_prefix.host&&t.data.vod_url_prefix.host.length>1&&(s=t.data.vod_url_prefix.host),t.data.vod_url_prefix.path&&t.data.vod_url_prefix.path.length>1&&(a=t.data.vod_url_prefix.path)),e.history_video_url_prefix=i+"//"+s+a,e.$log.debug("---\x3e history_video_url_prefix: "+e.history_video_url_prefix);for(var n=0;n<t.data.list.length;n++){t.data.list[n].duration=e.formatSeconds(t.data.list[n].duration),e.inputValue.push({value:"",Visible:!1});var r=t.data.list[n].label_set.substring(1,t.data.list[n].label_set.length-1).replace(/" /g,"").replace(/ "/g,"");t.data.list[n].label_set=r.split(","),""==t.data.list[n].label_set&&(t.data.list[n].label_set=[]),t.data.list[n].poster=""+e.history_video_url_prefix+t.data.list[n].url.replace(/\.(mp4|webm)/,".jpeg")}e.tableData=t.data.list}})},onPage:function(t){this.offset=this.limit*(t-1),this.fetchData(this.where)},formatSeconds:function(t){var e=parseInt(t),i=0,s=0;e>60&&(i=parseInt(e/60),e=parseInt(e%60),i>60&&(s=parseInt(i/60),i=parseInt(i%60)));var a=parseInt(e)+"秒";return i>0&&(a=parseInt(i)+"分"+a),s>0&&(a=parseInt(s)+"小时"+a),a},handleClose_tag:function(t,e){var i=this;return r()(a.a.mark(function s(){var n,r,o;return a.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return n="vod",r=i.tableData[t].id,(o=new URLSearchParams).append("label",e),s.next=6,i.$root.delTags(n,r,o).then(function(t){0==t&&i.fetchData(i.where)});case 6:case"end":return s.stop()}},s,i)}))()},showInput:function(t){var e=this;return r()(a.a.mark(function i(){return a.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:e.inputValue[t].Visible=!0,e.$nextTick(function(t){e.$refs.autocomplete[0].$refs.new_tag.focus()});case 2:case"end":return i.stop()}},i,e)}))()},handleInputConfirm:function(t){var e=this;return r()(a.a.mark(function i(){var s,n,r;return a.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(s="vod",n=e.tableData[t].id,(r=new URLSearchParams).append("label",e.inputValue[t].value),r.append("type","rtc"),!/^\s*$/.test(e.inputValue[t].value)){i.next=11;break}e.inputValue[t].Visible=!1,e.inputValue[t].value="",i.next=13;break;case 11:return i.next=13,e.$root.addTags(s,n,r).then(function(i){0==i&&(e.fetchData(e.where),e.inputValue[t].Visible=!1,e.inputValue[t].value="")});case 13:case"end":return i.stop()}},i,e)}))()},imgerror:function(){var t=event.srcElement;t.src="./static/images/none.png",t.onerror=null},handleClose:function(t){t()}},mounted:function(){var t=this.$root.get_current_user(),e=this.$route,i=[];e&&void 0!=e.query.tag_label&&i.push(e.query.tag_label);var s={where:{label:{op:"or",values:i},device_name:"",device_serial_number:"",admin_user_name:"",org_name:t.org_name}};this.fetchData(s)},sockets:{new_record_file:function(t){this.$log.info("new_record_file: "+t),this.tableData.push(function(t){var e=t.split("@");return{timestamp:moment(new Date(e[0])).format(),user_name:e[1].split(".")[0],fname:t}}(t))}}}}).call(e,i("7t+N"))},G2pm:function(t,e){},LH1p:function(t,e){},SvFk:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("0rgg"),a={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"HistoryVideos"},[i("div",{staticClass:"query_box"},[i("QueryFilter",{attrs:{current_type:"视频资料"}})],1),t._v(" "),i("div",{staticClass:"video_info_box"},t._l(t.tableData,function(e,s){return i("div",{key:s,staticClass:"videoInfo"},[null!=e.poster_fname?i("img",{attrs:{src:t.history_video_url_prefix+e.poster_fname,alt:""},on:{click:function(i){return t.handlePlay(s,e)},error:function(e){return t.imgerror()}}}):i("img",{ref:"vImg",refInFor:!0,attrs:{src:e.poster,alt:""},on:{click:function(i){return t.handlePlay(s,e)},error:function(e){return t.imgerror()}}}),t._v(" "),i("span",{staticClass:"delete"},[i("i",{staticClass:"el-icon-delete",attrs:{title:"删除"},on:{click:function(i){return i.stopPropagation(),t.confirmDelete(s,e)}}})]),t._v(" "),i("span",{staticClass:"duration",attrs:{title:"时长"}},[t._v(t._s(e.duration))]),t._v(" "),i("div",{staticClass:"text"},[i("span",[t._v(t._s(e.admin_user_name)+"/"+t._s(e.org_name))]),t._v(" "),i("span",[t._v(t._s(t.moment(e.begin_time).format("YYYY/MM/DD HH:mm:ss")))])]),t._v(" "),i("div",{staticClass:"tag-info"},[i("div",t._l(e.label_set,function(e){return i("el-tag",{key:e,attrs:{closable:"","disable-transitions":!1},on:{close:function(i){return t.handleClose_tag(s,e)}}},[t._v("\n            "+t._s(e)+"\n          ")])}),1),t._v(" "),t.inputValue[s].Visible?i("autocomplete",{ref:"autocomplete",refInFor:!0,attrs:{page:"vods",index:s}}):i("div",[i("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(e){return t.showInput(s)}}},[t._v("添加标签")])],1)],1)])}),0),t._v(" "),i("div",{staticClass:"pagination"},[i("el-pagination",{attrs:{layout:"prev, pager, next","page-size":t.limit,"pager-count":2*t.limit-1,"current-page":t.current_page,total:t.total},on:{"current-change":t.onPage}})],1),t._v(" "),i("el-dialog",{staticStyle:{overflow:"hidden"},attrs:{visible:t.showVideo,fullscreen:!0,title:"设备"+this.formatDeviceName(this.currentRow.device_serial_number,this.$root.deviceList)+"于"+t.moment(this.currentRow.begin_time).format("YYYY-MM-DD HH:mm:ss")+"的影音",top:"0","modal-append-to-body":!1,"before-close":t.handleClose},on:{"update:visible":function(e){t.showVideo=e}}},[t.showVideo?i("vod-player",{attrs:{vod:t.currentRow,url_prefix:t.history_video_url_prefix,where:t.where}}):t._e()],1)],1)},staticRenderFns:[]};var n=function(t){i("nzlR")},r=i("VU/8")(s.a,a,!1,n,null,null);e.default=r.exports},YHW8:function(t,e,i){"use strict";var s=i("Xxa5"),a=i.n(s),n=i("exGp"),r=i.n(n),o=(i("llnD"),{props:["vod"],data:function(){return{canvas:null,ctx:null,brushBtn:null,reSetCanvasBtn:null,aColorBtn:null,saveBtn:null,undoBtn:null,textBtn:null,rangeBtn:null,circleBtn:null,arrowsBtn:null,rectangleBtn:null,clear:!1,txt:!1,line:!0,arrows:!1,rectangle:!1,activeColor:"black",lWidth:4,historyDeta:[],Video:null,Img:null,brush_color:[{name:"白色",code:"white"},{name:"黑色",code:"black"},{name:"红色",code:"red"},{name:"蓝色",code:"blue"},{name:"黄色",code:"yellow"},{name:"绿色",code:"green"},{name:"灰色",code:"gray"}]}},mounted:function(){this.canvas=this.$refs.canvas,this.ctx=this.canvas.getContext("2d"),this.brushBtn=this.$refs.brush,this.reSetCanvasBtn=this.$refs.clear,this.aColorBtn=this.$refs.color_item,this.saveBtn=this.$refs.save,this.undoBtn=this.$refs.undo,this.rangeBtn=this.$refs.range,this.textBtn=this.$refs.text,this.arrowsBtn=this.$refs.arrows,this.rectangleBtn=this.$refs.rectangle,this.circleBtn=this.$refs.circle,this.listenToUser(this.canvas),this.getColor(),this.aColorBtn[1].classList.add("active")},methods:{take_picture:function(){var t=this.canvas,e=this.ctx;if(null!=this.Video){var i=this.Video;t.width=i.videoWidth,t.height=i.videoHeight,e.drawImage(i,0,0,i.videoWidth,i.videoHeight)}else if(null!=this.Img){var s=new Image;s.setAttribute("crossOrigin","anonymous"),s.src=this.Img.src,s.onload=function(){t.width=s.width,t.height=s.height,e.drawImage(s,0,0,t.width,t.height)}}else this.$log.error("视频或图片未传入")},listenToUser:function(t){var e=!1,i=this.ctx,s=this,a={x:void 0,y:void 0};void 0!==document.body.ontouchstart?(t.addEventListener("touchstart",function(n){var r=i.getImageData(0,0,t.width,t.height);s.saveData(r),e=!0;var o=n.touches[0].clientX-t.offsetLeft,l=n.touches[0].clientY-t.offsetTop;if(a={x:o,y:l},i.save(),1==s.txt){var c=s.$refs.tValue;c.style.display="block",c.style.color=i.fillStyle,c.style.left=n.touches[0].pageX+"px",c.style.top=n.touches[0].pageY+"px",setTimeout(function(){c.focus()},100),c.onkeyup=function(t){13==t.keyCode&&(s.fillText(c.value,o+1,l+19),c.value="",c.style.display="none")},e=!1}}),t.addEventListener("touchmove",function(n){if(e){var r={x:n.touches[0].clientX-t.offsetLeft,y:n.touches[0].clientY-t.offsetTop};if(1==s.line)s.drawLine(a.x,a.y,r.x,r.y),a=r;else if(1==s.rectangle){var o=s.historyDeta;i.putImageData(o[o.length-1],0,0),s.drawRect(a.x,a.y,n.touches[0].pageX-t.offsetLeft-a.x,n.touches[0].pageY-t.offsetTop-a.y)}else if(1==s.circle){var l=s.historyDeta;i.putImageData(l[l.length-1],0,0);var c=s.calculateRadius(a,r);s.drawcircle(a.x,a.y,c,0,2*Math.PI,!1)}else if(1==s.arrows){var d=s.historyDeta;i.putImageData(d[d.length-1],0,0),s.drawArrow(a.x,a.y,r.x,r.y,15,13,3)}}}),t.addEventListener("touchend",function(t){e=!1})):(t.onmousedown=function(n){var r=i.getImageData(0,0,t.width,t.height);s.saveData(r),e=!0;var o=n.pageX-t.offsetLeft,l=n.pageY-t.offsetTop;if(a={x:o,y:l},i.save(),1==s.txt){var c=s.$refs.tValue;c.style.color=i.fillStyle,c.style.left=n.clientX+"px",c.style.top=n.clientY+"px",c.style.display="block",setTimeout(function(){c.focus()},100),c.onkeyup=function(t){13==t.keyCode&&(s.fillText(c.value,o+1,l+19),c.value="",c.style.display="none")},e=!1}},t.onmousemove=function(n){if(e){var r={x:n.pageX-t.offsetLeft,y:n.pageY-t.offsetTop};if(1==s.line)s.drawLine(a.x,a.y,r.x,r.y),a=r;else if(1==s.rectangle){var o=s.historyDeta;i.putImageData(o[o.length-1],0,0),s.drawRect(a.x,a.y,n.offsetX-a.x,n.offsetY-a.y)}else if(1==s.circle){var l=s.historyDeta;i.putImageData(l[l.length-1],0,0);var c=s.calculateRadius(a,r);s.drawcircle(a.x,a.y,c,0,2*Math.PI,!1)}else if(1==s.arrows){var d=s.historyDeta;i.putImageData(d[d.length-1],0,0),s.drawArrow(a.x,a.y,r.x,r.y,15,13,3)}}},t.onmouseup=function(){e=!1},t.mouseleave=function(){e=!1})},drawLine:function(t,e,i,s){var a=this.ctx,n=this.lWidth;a.lineWidth=n,a.lineCap="round",a.lineJoin="round",a.beginPath(),a.moveTo(t,e),a.lineTo(i,s),a.stroke(),a.closePath()},saveData:function(t){var e=this.historyDeta;10===e.length&&e.shift(),e.push(t)},step_undo:function(){var t=this.historyDeta,e=this.ctx;if(t.length<1)return!1;e.putImageData(t[t.length-1],0,0),t.pop()},getColor:function(){for(var t=this.aColorBtn,e=this.activeColor,i=this.ctx,s=0;s<this.brush_color.length;s++)t[s].style.background=""+this.brush_color[s].code;for(var a=0;a<t.length;a++)t[a].onclick=function(){for(var s=0;s<t.length;s++)t[s].classList.remove("active"),this.classList.add("active"),e=this.style.backgroundColor,i.fillStyle=e,i.strokeStyle=e}},upload:function(){for(var t=this,e=this.canvas.toDataURL("image/jpeg"),i=e.split(","),s=i[0].match(/:(.*?);/)[1],a=atob(i[1]),n=a.length,r=new Uint8Array(n);n--;)r[n]=a.charCodeAt(n);var o=this.$root.get_current_user().id,l=new Blob([r],{type:s}),c=new FormData;c.append("video_id",this.vod.id),c.append("user_id",o),c.append("file",l,"snapshot.jpg");var d=this;this.axios.post("/snapshot/upload",c).then(function(i){0==i.data.ret.code&&null!=c&&void 0!=c&&t.$emit("add_imageList",e,i.data.id)}).catch(function(t){d.$log.error(t)}),this.Video=null,this.Img=null,this.reset_canvas()},reset_canvas:function(){var t=this.canvas;this.ctx.clearRect(0,0,t.width,t.height),this.take_picture(),this.getColor()},use_brush:function(){this.txt=!1,this.line=!0,this.clear=!1,this.rectangle=!1,this.circle=!1,this.arrows=!1,this.brushBtn.classList.add("active"),this.textBtn.classList.remove("active"),this.rectangleBtn.classList.remove("active"),this.circleBtn.classList.remove("active"),this.arrowsBtn.classList.remove("active"),this.$refs.tValue.style.display="none"},use_text:function(){this.txt=!0,this.line=!1,this.clear=!1,this.rectangle=!1,this.circle=!1,this.arrows=!1,this.textBtn.classList.add("active"),this.brushBtn.classList.remove("active"),this.rectangleBtn.classList.remove("active"),this.circleBtn.classList.remove("active"),this.arrowsBtn.classList.remove("active")},use_rectangle:function(){this.txt=!1,this.line=!1,this.clear=!1,this.rectangle=!0,this.circle=!1,this.arrows=!1,this.rectangleBtn.classList.add("active"),this.textBtn.classList.remove("active"),this.circleBtn.classList.remove("active"),this.brushBtn.classList.remove("active"),this.arrowsBtn.classList.remove("active"),this.$refs.tValue.style.display="none"},use_circle:function(){this.txt=!1,this.line=!1,this.clear=!1,this.rectangle=!1,this.circle=!0,this.arrows=!1,this.circleBtn.classList.add("active"),this.textBtn.classList.remove("active"),this.rectangleBtn.classList.remove("active"),this.brushBtn.classList.remove("active"),this.arrowsBtn.classList.remove("active"),this.$refs.tValue.style.display="none"},use_arrows:function(){this.txt=!1,this.line=!1,this.clear=!1,this.rectangle=!1,this.circle=!1,this.arrows=!0,this.arrowsBtn.classList.add("active"),this.textBtn.classList.remove("active"),this.rectangleBtn.classList.remove("active"),this.circleBtn.classList.remove("active"),this.brushBtn.classList.remove("active"),this.$refs.tValue.style.display="none"},change_rangeValue:function(){var t=this.rangeBtn.value;this.lWidth=t},fillText:function(t,e,i){var s=this.ctx;this.lWidth<15?s.font="15px Arial":s.font=this.lWidth+"px Arial",s.fillText(t,e,i)},drawRect:function(t,e,i,s){this.canvas;var a=this.ctx;a.lineWidth=this.lWidth,a.beginPath(),a.strokeRect(t,e,i,s)},drawcircle:function(t,e,i,s,a,n){var r=this.ctx;r.lineWidth=this.lWidth,r.beginPath(),r.arc(t,e,i,s,a,n),r.stroke()},calculateRadius:function(t,e){var i=e.x-t.x,s=e.y-t.y;return(i<0||s<0)&&(i=Math.abs(i)),Math.sqrt(Math.pow(i,2)+Math.pow(s,2))},drawArrow:function(t,e,i,s,a,n,r){this.canvas;var o=this.ctx;n=void 0!==(a=void 0!==a?a:30)?n:10,r=void 0!==r?r:1;var l=180*Math.atan2(e-s,t-i)/Math.PI,c=(l+a)*Math.PI/180,d=(l-a)*Math.PI/180,u=n*Math.cos(c),h=n*Math.sin(c),v=n*Math.cos(d),p=n*Math.sin(d);o.save(),o.beginPath();var f=t-u,m=e-h;o.moveTo(f,m),o.moveTo(t,e),o.lineTo(i,s),f=i+u,m=s+h,o.moveTo(f,m),o.lineTo(i,s),f=i+v,m=s+p,o.lineTo(f,m),o.lineWidth=r,o.closePath(),o.stroke(),o.restore()}}}),l={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"editPictureBox"},[i("div",{attrs:{id:"Canvas"}},[i("canvas",{ref:"canvas",attrs:{id:"drawing-board",width:"720",height:"402"}}),t._v(" "),i("input",{ref:"tValue",attrs:{id:"tValue",placeholder:"按Enter键打印文字",type:"text"}})]),t._v(" "),i("div",{staticClass:"color-group"},[i("ul",t._l(t.brush_color,function(t,e){return i("li",{key:e,ref:"color_item",refInFor:!0,staticClass:"color-item"})}),0)]),t._v(" "),i("div",{attrs:{id:"range-wrap"}},[i("input",{ref:"range",attrs:{type:"range",id:"range",min:"1",max:"30",value:"5",title:"调整笔刷粗细"},on:{click:t.change_rangeValue,touchmove:t.change_rangeValue}})]),t._v(" "),i("div",{staticClass:"tools"},[i("button",{ref:"brush",staticClass:"active",attrs:{id:"brush",title:"画笔"},on:{click:t.use_brush}},[i("i",{staticClass:"iconfont icon-qianbi"})]),t._v(" "),i("button",{ref:"rectangle",attrs:{id:"rectangle",title:"矩形"},on:{click:t.use_rectangle}},[i("i",{staticClass:"iconfont icon-Icon-"})]),t._v(" "),i("button",{ref:"circle",attrs:{id:"circle",title:"圆形"},on:{click:t.use_circle}},[i("i",{staticClass:"iconfont icon-39"})]),t._v(" "),i("button",{ref:"arrows",attrs:{id:"arrows",title:"箭头"},on:{click:t.use_arrows}},[i("i",{staticClass:"iconfont icon-arrow-right"})]),t._v(" "),i("button",{ref:"text",attrs:{id:"text",title:"文字"},on:{click:t.use_text}},[i("i",{staticClass:"iconfont icon-ziti"})]),t._v(" "),i("button",{ref:"clear",attrs:{id:"clear",title:"清空"},on:{click:t.reset_canvas}},[i("i",{staticClass:"iconfont icon-qingchu"})]),t._v(" "),i("button",{ref:"undo",attrs:{id:"undo",title:"撤销"},on:{click:t.step_undo}},[i("i",{staticClass:"iconfont icon-withdraw"})]),t._v(" "),i("button",{ref:"save",attrs:{id:"save",title:"保存"},on:{click:t.upload}},[i("i",{staticClass:"iconfont icon-baocun"})])])])},staticRenderFns:[]};var c=i("VU/8")(o,l,!1,function(t){i("LH1p")},null,null).exports,d=i("Hgbe"),u=i("mHVC"),h=(i("mtWM"),{components:{EditPicture:c,EditImg:d.a,autocomplete:u.a},props:["vod","url_prefix","where"],data:function(){return{index:0,imageList:[],inputVisible:!1,inputValue:"",rotate:0,pause:!0,video:!0,duration:0,durations:0,currentTime:0,time:null,isShow:!1,draging:!1,text:"倍速",scale:"缩放"}},methods:{mousedown:function(t){document.body.addEventListener("mousemove",this.mousemove),this.draging=!0},download:function(){var t=this,e=this.url_prefix+this.vod.url,i=new XMLHttpRequest;i.open("get",e,!0),i.responseType="blob",i.onload=function(){if(200===this.status){var e=this.response,i=new FileReader;i.readAsDataURL(e),i.onload=function(e){var i=document.createElement("a");i.download=t.$parent.title,i.href=e.target.result,i.click(),window.URL.revokeObjectURL(e.target.result)}}},i.send()},click:function(t){var e=(100*(t.clientX-20)/this.$refs.vodPlayerContainer.clientWidth).toFixed(2);document.getElementById("pgs-play").style.width=e+"%";var i=document.getElementById("player");i.currentTime=(Number(e)*i.duration/100).toFixed(2)},mousemove:function(t){var e=this.$refs.vodPlayerContainer.clientWidth.toFixed(2);if(this.draging&&t.clientX>=20&&t.clientX<=20+e){var i=(t.clientX-20)/e,s=Math.ceil(100*i)>=100?100:Math.ceil(100*i);document.getElementById("pgs-play").style.width=s+"%";var a=document.getElementById("player");a.currentTime=(Number(s)*a.duration/100).toFixed(2)}},getTime:function(t){var e=t%3600;return(Math.floor(t/3600)>9?Math.floor(t/3600):"0"+Math.floor(t/3600))+":"+(Math.floor(e/60)>9?Math.floor(e/60):"0"+Math.floor(e/60))+":"+(Math.floor(e%60)>9?Math.floor(e%60):"0"+Math.floor(e%60))},mouseup:function(t){this.draging&&(this.draging=!1,document.body.removeEventListener("mousemove",this.mousemove))},getvideoprogress:function(){var t=this;this.width=0,this.time&&clearTimeout(this.time),this.time=setTimeout(function(){var e=document.getElementById("player"),i=e.currentTime.toFixed(2);t.currentTime=t.getTime(e.currentTime);var s=Number((100*Number(i)/Number(t.duration)).toFixed(2));if(document.getElementById("pgs-play").style.width=s+"%",Number(i)>=Number(t.duration))return t.pause=!1,!1;t.getvideoprogress()},50)},handleCommand:function(t){var e=document.getElementById("player");this.text=t+"X",e.playbackRate=t},handleScale:function(t){this.scale=t+"倍",document.getElementById("player").style.transform="translate(-50%, -50%) scale("+t+")"},mouseenter:function(){this.isShow=!0},mouseleave:function(){this.isShow=!1},changePause:function(t){console.log(t);var e=document.getElementById("player");2==t?(this.pause=!0,e.play()):(this.pause=!1,e.pause()),this.getvideoprogress()},changeVideo:function(t){console.log(t);var e=document.getElementById("player");1==t?(e.muted=!0,this.video=!1):(e.muted=!1,this.video=!0)},show_button:function(t){this.$refs.edit_button[t].style.display="block"},hidden_button:function(t){this.$refs.edit_button[t].style.display="none"},changeOrder:function(t){var e=document.querySelector(".video-info");"left"==t?this.rotate+=90:this.rotate-=90,e.style.transform="rotate("+this.rotate+"deg)"},zoomIn:function(t,e){this.index=e;var i=this.$refs.click_img,s=this.$refs.historyVideo;i.classList.remove("zoomOut"),i.classList.remove("animated"),i.className+=" zoomIn animated",setTimeout(function(){i.style.display="block",s.pause()},300)},hidden_img:function(){var t=this.$refs.click_img,e=this.$refs.historyVideo;t.classList.remove("zoomIn"),t.classList.remove("animated"),t.className+="  zoomOut animated",setTimeout(function(){t.style.display="none",e.play()},500)},take_snapshot:function(){var t=this,e=document.createElement("canvas"),i=this.$refs.historyVideo;e.width=i.videoWidth,e.height=i.videoHeight;var s=e.getContext("2d");i.setAttribute("crossOrigin","anonymous"),s.drawImage(i,0,0,i.videoWidth,i.videoHeight);for(var a=e.toDataURL("image/jpeg"),n=a.split(","),r=n[0].match(/:(.*?);/)[1],o=atob(n[1]),l=o.length,c=new Uint8Array(l);l--;)c[l]=o.charCodeAt(l);var d=this.$root.get_current_user(),u=d.id,h=new Blob([c],{type:r}),v=new FormData;v.append("video_id",this.vod.id),v.append("user_id",u),v.append("file",h,"snapshot.jpg"),this.axios.post("/snapshot/upload",v).then(function(e){if(0==e.data.ret.code){var i={admin_id:u,admin_user_name:d.user_name,device_sn:t.vod.device_serial_number,id:e.data.id,src:a,vod_id:t.vod.id,time:moment(new Date).utcOffset("+0800").format("YYYY-MM-DD HH:mm:ss")};t.imageList.splice(0,0,i)}})},add_imageList:function(t,e){var i=this.$root.get_current_user(),s={admin_id:i.id,admin_user_name:i.user_name,device_sn:this.vod.device_serial_number,id:e,src:t,vod_id:this.vod.id,time:moment(new Date).utcOffset("+0800").format("YYYY-MM-DD HH:mm:ss")};this.imageList.splice(0,0,s),null!=t&&""!=t&&this.close_editing_picture()},del_picture:function(t,e){var i=this;this.$confirm("确认删除吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){i.axios.delete("/snapshot/delete/"+t).then(function(){i.imageList.splice(e,1)}).catch(function(t){i.$log.error(t)})})},edit_picture:function(t,e){var i=this.$refs.draw,s=this.$refs.historyVideo;i.classList.remove("zoomOut"),i.classList.remove("animated"),i.className+="  zoomIn animated",setTimeout(function(){i.style.display="block",s.pause()},300),this.$refs.edit_picture.Img=t,this.$refs.edit_picture.take_picture()},open_editing_picture:function(){var t=this,e=this.$refs.draw,i=this.$refs.historyVideo;e.classList.remove("zoomOut"),e.classList.remove("animated"),e.className+="  zoomIn animated",setTimeout(function(){e.style.display="block",i.pause()},300),setTimeout(function(){t.$refs.edit_picture.Video=i,t.$refs.edit_picture.take_picture()},1e3)},close_editing_picture:function(){var t=this.$refs.draw,e=this.$refs.historyVideo;t.classList.remove("zoomIn"),t.classList.remove("animated"),t.className+="  zoomOut animated",setTimeout(function(){t.style.display="none",e.play()},500),this.$refs.edit_picture.Video=null,this.$refs.edit_picture.Img=null},towards_left:function(){this.index--},towards_right:function(){this.index++},showInput:function(t){var e=this;this.inputVisible=!0,this.$nextTick(function(t){e.$refs.autocomplete.$refs.new_tag.focus()})},handleClose:function(t,e){var i=this;return r()(a.a.mark(function s(){var n,r,o;return a.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return i,n="vod",r=i.vod.id,(o=new URLSearchParams).append("label",e),s.next=7,i.$root.delTags(n,r,o).then(function(e){0==e&&(i.$parent.$parent.fetchData(i.where),i.vod.label_set.splice(t,1))});case 7:case"end":return s.stop()}},s,i)}))()},handleInputConfirm:function(t){var e=this;return r()(a.a.mark(function t(){var i,s,n;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:i="vod",s=e.vod.id,(n=new URLSearchParams).append("label",e.inputValue),/^\s*$/.test(e.inputValue)?(e.inputVisible=!1,e.inputValue=""):e.$root.addTags(i,s,n).then(function(t){0==t&&(e.$parent.$parent.fetchData(e.where),e.vod.label_set.push(e.inputValue),e.inputVisible=!1,e.inputValue="")});case 6:case"end":return t.stop()}},t,e)}))()},set_poster:function(t,e){var i=this,s={id:t.id,vod_id:t.vod_id};this.axios.put("/v2/snapshot/set_poster",s).then(function(t){0==t.data.ret.code?(i.$parent.$parent.fetchData(i.where),i.$message.success("视频缩略图设置成功")):i.$message.error("视频缩略图设置失败,"+t.data.ret.cn)})}},mounted:function(){var t=this;this.$root.fetchImageList(this.vod.id,0,1e3,this.imageList,this.vod.device_type,{where:{label:{op:"or",values:[]}}}).catch(function(e){t.$log.error(e)});var e=this.$refs.historyVideo;e.src=this.url_prefix+this.vod.url,e.addEventListener("loadedmetadata",function(){t.duration=e.duration.toFixed(2),t.durations=t.getTime(e.duration),t.getvideoprogress()}),document.body.addEventListener("mouseup",this.mouseup)},computed:{}}),v={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"vodPlayer"},[i("div",{staticClass:"display-box"},[i("div",{ref:"vodPlayerContainer",staticClass:"vodPlayer-container"},[i("div",{staticClass:"video-info",on:{mouseenter:t.mouseenter,mouseleave:t.mouseleave}},[i("video",{ref:"historyVideo",attrs:{id:"player",autoplay:""}}),t._v(" "),i("span",{directives:[{name:"show",rawName:"v-show",value:!t.pause,expression:"!pause"}],staticClass:"playicon",on:{click:function(e){return t.changePause(2)}}},[i("svg",{staticClass:"play",attrs:{width:"16px",height:"24px",viewBox:"0 0 16 24",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"}},[i("g",{attrs:{id:"设计文件",stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd",transform:"translate(-832.000000, -636.000000)"}},[i("g",{attrs:{id:"1",transform:"translate(832.000000, 636.000000)",fill:"#FFFFFF","fill-rule":"nonzero"}},[i("path",{attrs:{d:"M0,2 C0,1.18662744 0.91936972,0.713503333 1.58123819,1.18626653 L15.5812382,11.1862665 C16.1395873,11.5850873 16.1395873,12.4149127 15.5812382,12.8137335 L1.58123819,22.8137335 C0.91936972,23.2864967 0,22.8133726 0,22 L0,2 Z",id:"Path-5-Copy-2"}})])])])])]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.isShow,expression:"isShow"}],staticClass:"coat-ctls",on:{mouseenter:t.mouseenter}},[i("div",{staticClass:"shirt-pgs",on:{click:t.click,mousedown:t.mousedown}},[i("div",{ref:"underdress",staticClass:"underdress-pgs"},[i("div",{staticClass:"pgs-buffer"}),t._v(" "),i("div",{ref:"pgsPlay",staticClass:"pgs-play",attrs:{id:"pgs-play"}},[i("span",{staticClass:"pit"})])])]),t._v(" "),i("div",{staticClass:"shirt-btns"},[i("div",{staticClass:"btn btn-play btn-pause"},[t.pause?i("a",{attrs:{href:"javascript:void(0);",title:"暂停",monkey:"player-pause"},on:{click:function(e){return t.changePause(1)}}},[i("svg",{staticClass:"pause",attrs:{width:"16px",height:"24px",viewBox:"0 0 16 24",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"}},[i("g",{attrs:{id:"pasue",stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd",transform:"translate(-863.000000, -636.000000)"}},[i("g",{attrs:{id:"Group-9-Copy",transform:"translate(863.000000, 637.000000)",fill:"#FFFFFF"}},[i("g",{attrs:{id:"Group-8"}},[i("g",{attrs:{id:"Group-2"}},[i("rect",{attrs:{id:"Rectangle-4",x:"0",y:"0",width:"4",height:"22",rx:"2"}}),t._v(" "),i("rect",{attrs:{id:"Rectangle-4-Copy",x:"10",y:"0",width:"4",height:"22",rx:"2"}})])])])])])]):i("a",{attrs:{href:"javascript:void(0);",title:"播放",monkey:"player-play"},on:{click:function(e){return t.changePause(2)}}},[i("svg",{staticClass:"play",attrs:{width:"16px",height:"24px",viewBox:"0 0 16 24",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"}},[i("g",{attrs:{id:"设计文件",stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd",transform:"translate(-832.000000, -636.000000)"}},[i("g",{attrs:{id:"1",transform:"translate(832.000000, 636.000000)",fill:"#FFFFFF","fill-rule":"nonzero"}},[i("path",{attrs:{d:"M0,2 C0,1.18662744 0.91936972,0.713503333 1.58123819,1.18626653 L15.5812382,11.1862665 C16.1395873,11.5850873 16.1395873,12.4149127 15.5812382,12.8137335 L1.58123819,22.8137335 C0.91936972,23.2864967 0,22.8133726 0,22 L0,2 Z",id:"Path-5-Copy-2"}})])])])])]),t._v(" "),i("div",{staticClass:"btn btn-vol"},[i("a",{attrs:{href:"javascript:void(0);",title:"音量",monkey:"player-vol"}},[i("div",{staticClass:"horn-mute horn-vol"},[t.video?i("svg",{staticClass:"mute",attrs:{width:"17px",height:"24px",viewBox:"0 0 17 24",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"},on:{click:function(e){return t.changeVideo(1)}}},[i("g",{attrs:{id:"设计文件",stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd",transform:"translate(-959.000000, -636.000000)"}},[i("g",{attrs:{id:"Group-11-Copy-6",transform:"translate(959.000000, 640.000000)",fill:"#FFFFFF","fill-rule":"nonzero"}},[i("g",{attrs:{id:"Group-Copy-2"}},[i("path",{attrs:{d:"M14.6230545,12.7821592 C14.1910634,13.1262488 13.5619273,13.0549886 13.2178396,12.6229951 C12.8737519,12.1910015 12.9450117,11.5618618 13.3770028,11.2177721 C14.4097962,10.3951313 15.0000191,9.14876999 15.0000191,7.99998098 C15.0000191,6.99541158 14.4125031,5.84230578 13.2880564,4.70219433 C12.9002454,4.30898067 12.9046232,3.67583326 13.2978346,3.28802 C13.691046,2.90020674 14.3241898,2.90458464 14.7120009,3.2977983 C16.1745064,4.78067804 17,6.40085774 17,7.99998098 C17,9.7528799 16.1362305,11.5768838 14.6230545,12.7821592 Z",id:"Oval-Copy-4"}}),t._v(" "),i("path",{attrs:{d:"M3.64921894,11.9989573 L1,11.9989573 C0.44771525,11.9989573 0,11.5513354 0,10.9991658 L0,5.00083418 C0,4.44866461 0.44771525,4.00104273 1,4.00104273 L3.64921894,4.00104273 L9.37530495,0.220962401 C10.0300683,-0.302739036 11,0.163337022 11,1.00166836 L11,14.9983316 C11,15.836663 10.0300683,16.302739 9.37530495,15.7790376 L3.64921894,11.9989573 Z",id:"Path-2-Copy"}})])])])]):i("svg",{staticClass:"vol",attrs:{width:"17px",height:"24px",viewBox:"0 0 17 24",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"},on:{click:function(e){return t.changeVideo(2)}}},[i("g",{attrs:{id:"设计文件",stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd",transform:"translate(-931.000000, -636.000000)"}},[i("path",{attrs:{d:"M944.722753,650.682035 C945.572457,649.896701 946,648.791637 946,647.793085 C946,646.830084 945.412478,645.724693 944.288021,644.631759 C943.900206,644.254816 943.904584,643.647868 944.297799,643.276102 C944.691015,642.904336 945.324164,642.908533 945.711979,643.285476 C947.174499,644.706995 948,646.260132 948,647.793085 C948,649.313083 947.35068,650.918323 946.106758,652.066041 L944.722753,650.682035 Z",id:"Combined-Shape-Copy",fill:"#FFFFFF"}}),t._v(" "),i("rect",{attrs:{id:"Rectangle-Copy-3",fill:"#FFFFFF",transform:"translate(939.131728, 650.131728) rotate(-45.000000) translate(-939.131728, -650.131728) ",x:"938.131728",y:"639.631728",width:"2",height:"21",rx:"1"}}),t._v(" "),i("path",{attrs:{d:"M932.174282,644.000938 L942,653.826657 L942,654.998358 C942,655.836667 941.030068,656.302731 940.375305,655.779043 L934.649219,651.999062 L932,651.999062 C931.447715,651.999062 931,651.551451 931,650.999296 L931,645.000704 C931,644.448549 931.447715,644.000938 932,644.000938 L932.174282,644.000938 Z M936.565882,642.735685 L940.375305,640.220957 C941.030068,639.697269 942,640.163333 942,641.001642 L942,648.169803 L936.565882,642.735685 Z",id:"Path-2-Copy-3",fill:"#FFFFFF","fill-rule":"nonzero"}})])])]),t._v(" "),t._m(0)])]),t._v(" "),i("div",{staticClass:"btn tools"},[i("i",{staticClass:"el-icon-refresh-left",on:{click:function(e){return t.changeOrder("left")}}}),t._v(" "),i("i",{staticClass:"el-icon-refresh-right",on:{click:function(e){return t.changeOrder("right")}}})]),t._v(" "),i("div",{staticClass:"btn btn-time"},[i("span",{staticClass:"now"},[t._v(t._s(t.currentTime))]),t._v(" / "),i("span",{staticClass:"total"},[t._v(t._s(t.durations))])]),t._v(" "),i("el-dropdown",{attrs:{placement:"top"},on:{command:t.handleCommand}},[i("span",{staticClass:"el-dropdown-link"},[i("div",{staticClass:"btn bs"},[i("span",[t._v(t._s(t.text))])])]),t._v(" "),i("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[i("el-dropdown-item",{staticStyle:{padding:"0 10px"},attrs:{command:"2"}},[t._v("2X")]),t._v(" "),i("el-dropdown-item",{staticStyle:{padding:"0 10px"},attrs:{command:"1.5"}},[t._v("1.5X")]),t._v(" "),i("el-dropdown-item",{staticStyle:{padding:"0 10px"},attrs:{command:"1"}},[t._v("1X")]),t._v(" "),i("el-dropdown-item",{staticStyle:{padding:"0 10px"},attrs:{command:"0.5"}},[t._v("0.5X")])],1)],1),t._v(" "),i("el-dropdown",{attrs:{placement:"top"},on:{command:t.handleScale}},[i("span",{staticClass:"el-dropdown-link"},[i("div",{staticClass:"btn bs"},[i("span",[t._v(t._s(t.scale))])])]),t._v(" "),i("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[i("el-dropdown-item",{staticStyle:{padding:"0 10px"},attrs:{command:"1.5"}},[t._v("1.5倍")]),t._v(" "),i("el-dropdown-item",{staticStyle:{padding:"0 10px"},attrs:{command:"1.2"}},[t._v("1.2倍")]),t._v(" "),i("el-dropdown-item",{staticStyle:{padding:"0 10px"},attrs:{command:"1"}},[t._v("1倍")]),t._v(" "),i("el-dropdown-item",{staticStyle:{padding:"0 10px"},attrs:{command:"0.5"}},[t._v("0.5倍")])],1)],1),t._v(" "),i("div",{staticClass:"btn btn-download",on:{click:t.download}},[i("i",{staticClass:"el-icon-download"})]),t._v(" "),i("div",{staticClass:"btn bs",on:{click:t.take_snapshot}},[t._v("截图")])],1)])]),t._v(" "),i("div",{staticClass:"divider"},[i("el-divider",{attrs:{direction:"vertical"}})],1),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.imageList,expression:"imageList"}],staticClass:"image-info"},[t._m(1),t._v(" "),t._l(t.imageList,function(e,s){return i("div",{key:s,staticClass:"block"},[i("el-image",{attrs:{src:e.src,fit:"cover"},on:{click:function(e){return t.zoomIn(e,s)}}}),t._v(" "),i("span",[t._v(t._s(e.time))]),t._v(" "),i("div",{ref:"edit_button",refInFor:!0,staticClass:"edit_button"},[i("i",{staticClass:"iconfont icon-shengchenghaibao",attrs:{title:"设置海报"},on:{click:function(i){return t.set_poster(e,s)}}}),t._v(" "),i("i",{staticClass:"el-icon-delete",attrs:{title:"删除"},on:{click:function(i){return t.del_picture(e.id,s)}}}),t._v(" "),i("i",{staticClass:"el-icon-edit-outline",attrs:{title:"编辑"},on:{click:function(i){return t.edit_picture(e,s)}}})])],1)})],2)]),t._v(" "),t.imageList[t.index]?i("div",{ref:"click_img",staticClass:"enlarge_image",on:{click:t.hidden_img}},[i("p",[t._v(t._s(t.imageList[t.index].time))]),t._v(" "),i("div",{staticClass:"show_image"},[i("el-image",{attrs:{src:t.imageList[t.index].src,fit:"contain"}}),t._v(" "),i("i",{directives:[{name:"show",rawName:"v-show",value:t.index>0,expression:"index > 0"}],staticClass:"el-icon-back",attrs:{title:"后一张"},on:{click:function(e){return e.stopPropagation(),t.towards_left.apply(null,arguments)}}}),t._v(" "),i("i",{directives:[{name:"show",rawName:"v-show",value:t.index<t.imageList.length-1,expression:"index < imageList.length - 1"}],staticClass:"el-icon-right",attrs:{title:"前一张"},on:{click:function(e){return e.stopPropagation(),t.towards_right.apply(null,arguments)}}})],1)]):t._e(),t._v(" "),i("div",{ref:"draw",staticClass:"draw"},[i("i",{staticClass:"closeDraw el-icon-close",on:{click:t.close_editing_picture}}),t._v(" "),i("div",{staticClass:"icon_button"},[i("EditImg",{ref:"edit_picture",on:{add_imageList:t.add_imageList}})],1)]),t._v(" "),i("div",{staticClass:"tags"},[t._l(t.vod.label_set,function(e,s){return i("el-tag",{key:e,attrs:{closable:"","disable-transitions":!1},on:{close:function(i){return t.handleClose(s,e)}}},[t._v("\n      "+t._s(e)+"\n    ")])}),t._v(" "),t.inputVisible?i("autocomplete",{ref:"autocomplete",attrs:{page:"vod",index:t.index}}):i("div",{staticStyle:{display:"inline-block"}},[i("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(e){return t.showInput(t.index)}}},[t._v("添加标签")])],1)],2)])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"bar-setvol"},[e("div",{staticClass:"coat-setval"},[e("div",{staticClass:"setvol",staticStyle:{width:"50%"}},[e("span",{staticClass:"pit"})])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("strong",[this._v("视频截图库")])])}]};var p=i("VU/8")(h,v,!1,function(t){i("G2pm")},"data-v-0dde3957",null);e.a=p.exports},llnD:function(t,e){},nzlR:function(t,e){}});