webpackJsonp([5],{K4P0:function(e,r){},dGnv:function(e,r,s){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var t=s("Xxa5"),n=s.n(t),o=s("exGp"),i=s.n(o),a=s("7+uW"),c={data:function(){var e=this,r=function(r,s,t){""===s?t(new Error("请输入密码")):s&&s.length<6?t(new Error("密码长度至少是6位")):(""!==e.newUser.confirm_password&&e.$refs.newUserForm.validateField("confirm_password"),t())},s=function(r,s,t){""===s?t(new Error("请再次输入密码")):s!==e.newUser.password?t(new Error("两次输入密码不一致!")):t()};return{isleaveGroup:!1,isAddUser:!1,groups:[],filterText:"",userInfo:[],currentRow:{},defaultProps:{children:"children",label:"name"},newUserFormRule:{user_name:[{required:!0,message:"请输入登录名"}],nick_name:[{required:!0,message:"请输入用户名称"}],password:[{validator:r,trigger:"blur"},{required:!0,message:"请输入用户登录密码"}],confirm_password:[{validator:s,trigger:"blur"},{required:!0,message:"请再次输入密码"}]},editUserFormRule:{password:[{validator:r,trigger:"blur"}],confirm_password:[{validator:s,trigger:"blur"}]},newUser:{},currentGroup:{},currentUser:{}}},mounted:function(){var e=this,r=this.$root.get_current_user();this.currentUser=r,this.$root.getUserBYGroupId(r.org_id,"all").then(function(r){void 0!=r&&(e.userInfo=r)})},methods:{closeDialog:function(){this.isAddUser=!1,this.newUser={}},addNewUser:function(){this.isAddUser=!0,this.newUser={id:"",user_name:"",nick_name:"",is_locked:!1,is_root:!1,memo:"",password:"",confirm_password:""},this.$refs.newUserForm.resetFields()},submitUserForm:function(){var e=this;this.$refs.newUserForm.validate(function(r){r&&(e.newUser.id?e.saveUser():e.createUser())})},createUser:function(){var e=this,r=this;this.axios.post("/admin/create",this.newUser).then(function(s){0==s.data.ret.code?(e.dialogFormVisible=!1,e.$message.success("创建用户成功"),e.userInfo.push({user_name:e.newUser.user_name,nick_name:e.newUser.nick_name,orgName:e.currentGroup.name,created_at:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),is_locked:e.newUser.is_locked,is_root:e.newUser.is_root,memo:e.newUser.memo}),r.newUser.id=s.data.id,delete r.newUser.password,delete r.newUser.confirm_password,r.newUser={},r.isAddUser=!1,r.userjoin(s.data.id)):e.$message.error("创建用户失败, 错误原因:"+e.apiErrorMessage(s))})},onEdit:function(e,r){var s=this;this.isAddUser=!0,this.currentRow=r,a.default.nextTick(function(){s.$refs.newUserForm.resetFields(),s.newUser={id:r.user_id,user_name:r.user_name,nick_name:r.nick_name,is_locked:r.is_locked,is_root:r.is_root,memo:r.memo,current_row:e}})},saveUser:function(){var e=this,r={id:this.newUser.id,is_locked:this.newUser.is_locked,is_root:this.newUser.is_root,memo:this.newUser.memo,nick_name:this.newUser.nick_name,user_name:this.newUser.user_name};this.newUser.is_initpwd&&(r.password="123456",r.confirm_password="123456"),this.axios.put("/admin/update/"+r.id,r).then(function(r){0==r.data.ret.code?(e.isAddUser=!1,e.$message.success("更改成功"),e.userInfo.splice(e.newUser.current_row,1,{user_id:e.currentRow.user_id,org_id:e.currentRow.org_id,user_name:e.newUser.user_name,nick_name:e.newUser.nick_name,orgName:e.currentGroup.name,created_at:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),is_locked:e.newUser.is_locked,is_root:e.newUser.is_root,memo:e.newUser.memo}),e.newUser={}):e.$message.error("更改失败, 错误原因:"+e.apiErrorMessage(r))})},confirmDelete:function(e,r){var s=this,t=this;this.$confirm('此操作将永久删除用户名为<strong><font color="red">'+r.nick_name+"</font></strong>的用户, 是否继续?","警告",{confirmButtonText:"我知道我在做什么，请继续",cancelButtonText:"取消",confirmButtonClass:"el-button--danger",type:"warning",dangerouslyUseHTMLString:!0}).then(function(){s.axios.delete("/admin/delete/"+r.user_id).then(function(n){0==n.data.ret.code?(s.$message.success("用户"+r.name+"已删除"),t.userInfo.splice(e,1),t.leaveGroup(e,r)):s.$message.error("删除用户失败, 错误原因:"+s.apiErrorMessage(n))})}).catch(function(){})},updateAdmin:function(e,r,s,t){var n=this;return this.axios.put("/admin/update/"+e,r).then(function(e){return 0==e.data.ret.code?(n.$message.success(""+s),!0):(n.$message.error(t+", 错误原因:"+e.data.ret.cn),!1)}).catch(function(e){return n.$message.error("网络错误"),!1})},toggleUserLock:function(e){var r=this;return i()(n.a.mark(function s(){return n.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,r.updateAdmin(e.user_id,{is_locked:!e.is_locked},"用户"+e.user_name+" "+(e.is_locked?"解锁":"锁定")+"成功","用户"+e.user_name+" "+(e.is_locked?"解锁":"锁定")+"失败");case 2:s.sent&&(e.is_locked=!e.is_locked);case 4:case"end":return s.stop()}},s,r)}))()}}},l={render:function(){var e=this,r=e.$createElement,s=e._self._c||r;return s("div",{staticClass:"usergroup"},[s("div",{staticClass:"tool"},[s("el-button",{staticClass:"addUser",attrs:{type:"primary",size:"small"},on:{click:e.addNewUser}},[e._v("添加用户")])],1),e._v(" "),s("div",{staticClass:"content"},[s("div",{staticClass:"group"},[s("el-table",{staticStyle:{width:"100%"},attrs:{data:e.userInfo,stripe:"",border:"",center:""}},[s("el-table-column",{attrs:{prop:"nick_name",label:"用户名称"},scopedSlots:e._u([{key:"default",fn:function(r){return[s("span",{attrs:{title:r.row.nick_name}},[e._v(e._s(r.row.nick_name))])]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"created_at",label:"创建时间"},scopedSlots:e._u([{key:"default",fn:function(r){return[s("span",{attrs:{title:e.moment(r.row.created_at).format("YYYY-MM-DD HH:mm:ss")}},[e._v(e._s(e.moment(r.row.created_at).format("YYYY-MM-DD HH:mm:ss")))])]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(r){return[s("el-button",{attrs:{size:"small",type:"info",plain:""},on:{click:function(s){return e.onEdit(r.$index,r.row)}}},[e._v("编辑")]),e._v(" "),s("el-button",{attrs:{size:"small",type:"danger",plain:""},on:{click:function(s){return e.confirmDelete(r.$index,r.row)}}},[e._v("删除")])]}}])})],1)],1)]),e._v(" "),s("div",{staticClass:"AddUser"},[s("el-dialog",{attrs:{title:e.newUser.id?"编辑用户":"新建用户",visible:e.isAddUser,"append-to-body":"",width:"40%"},on:{"update:visible":function(r){e.isAddUser=r}}},[s("span",{staticStyle:{display:"block","line-height":"30px"}},[e._v("当前组织: "),s("strong",[e._v(e._s(e.currentGroup.name))])]),e._v(" "),s("el-form",{ref:"newUserForm",staticStyle:{width:"100%"},attrs:{model:e.newUser,"label-width":"120px",rules:e.newUser.id?e.editUserFormRule:e.newUserFormRule}},[s("el-form-item",{attrs:{label:"用户登录名",prop:"user_name"}},[s("el-input",{attrs:{"auto-complete":"off",disabled:!!e.newUser.id,placeholder:"请输入用户登录名"},model:{value:e.newUser.user_name,callback:function(r){e.$set(e.newUser,"user_name",r)},expression:"newUser.user_name"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"用户名称",prop:"nick_name"}},[s("el-input",{attrs:{"auto-complete":"off",placeholder:"请输入用户名称"},model:{value:e.newUser.nick_name,callback:function(r){e.$set(e.newUser,"nick_name",r)},expression:"newUser.nick_name"}})],1),e._v(" "),e.newUser.id?e._e():s("el-form-item",{attrs:{label:"登录密码",prop:"password"}},[s("el-input",{attrs:{"auto-complete":"new-password",placeholder:"请输入用户登录密码","show-password":"",type:"password"},model:{value:e.newUser.password,callback:function(r){e.$set(e.newUser,"password",r)},expression:"newUser.password"}})],1),e._v(" "),e.newUser.id?e._e():s("el-form-item",{attrs:{label:"再次输入密码",prop:"confirm_password"}},[s("el-input",{attrs:{"auto-complete":"off",placeholder:"请再次输入用户登录密码","show-password":"",type:"password"},model:{value:e.newUser.confirm_password,callback:function(r){e.$set(e.newUser,"confirm_password",r)},expression:"newUser.confirm_password"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"根用户",prop:"is_root"}},[s("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#DCDFE6"},model:{value:e.newUser.is_root,callback:function(r){e.$set(e.newUser,"is_root",r)},expression:"newUser.is_root"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"锁定",prop:"is_locked"}},[s("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#DCDFE6"},model:{value:e.newUser.is_locked,callback:function(r){e.$set(e.newUser,"is_locked",r)},expression:"newUser.is_locked"}})],1),e._v(" "),e.newUser.id&&"root"==e.currentUser.user_name?s("el-form-item",{attrs:{label:"初始化密码",prop:"is_initpwd"}},[s("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#DCDFE6"},model:{value:e.newUser.is_initpwd,callback:function(r){e.$set(e.newUser,"is_initpwd",r)},expression:"newUser.is_initpwd"}})],1):e._e(),e._v(" "),s("el-form-item",{attrs:{label:"备注信息"}},[s("el-input",{attrs:{type:"textarea",rows:4,placeholder:"备注信息"},model:{value:e.newUser.memo,callback:function(r){e.$set(e.newUser,"memo",r)},expression:"newUser.memo"}})],1),e._v(" "),s("el-form-item",[s("el-button",{attrs:{type:"info"},on:{click:e.closeDialog}},[e._v("取 消")]),e._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:e.submitUserForm}},[e._v("保 存")])],1)],1)],1)],1),e._v(" "),s("div")])},staticRenderFns:[]};var d=s("VU/8")(c,l,!1,function(e){s("K4P0")},"data-v-5ccd7f6e",null);r.default=d.exports}});