webpackJsonp([3],{"1hn1":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});i("mtWM");var a=i("BO1k"),s=i.n(a),n={name:"ipInput",data:function(){return{ip1:"",ip2:"",ip3:"",ip4:""}},props:["defaultIp","disabled"],created:function(){if(console.log("this.defaultIp:",this.defaultIp),this.defaultIp){var e=this.defaultIp.split(".");this.ip1=e[0],this.ip2=e[1],this.ip3=e[2],this.ip4=e[3]}},methods:{clearValue:function(){this.ip1="",this.ip2="",this.ip3="",this.ip4=""},submitIp:function(){var e=this.ip1+"."+this.ip2+"."+this.ip3+"."+this.ip4;this.$emit("getIpVal",e),this.$parent.$emit("el.form.change")},checkVal:function(e,t){if(parseInt(e)>255)switch(t){case"ip1":this.ip1=255,this.focusInput(2);break;case"ip2":this.ip2=255,this.focusInput(3);break;case"ip3":this.ip3=255,this.focusInput(4);break;case"ip4":this.ip4=255}else if(parseInt(e)<=255&&parseInt(e)>=100)switch(t){case"ip1":this.focusInput(2);break;case"ip2":this.focusInput(3);break;case"ip3":this.focusInput(4)}},focusInput:function(e){switch(e){case"ip2":this.$refs.ip2.focus();break;case"ip3":this.$refs.ip3.focus();break;case"ip4":this.$refs.ip4.focus()}},keyupEvent:function(e,t){console.log("index, e:",e,this["ip"+e]);var i=this["ip"+e];/^\d+$/.test(i)&&(this["ip"+e]=parseInt(i),this.submitIp(),console.log("数字:",i)),110===t.keyCode&&(1==e?this.$refs.ip2.focus():2==e?this.$refs.ip3.focus():3==e&&this.$refs.ip4.focus())}}},r={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"ip-box",style:{width:(e.$attrs.attrs,"260px")}},[i("el-input",{ref:"ip1",attrs:{size:"small",disabled:e.disabled,name:"ip",maxlength:"3",onkeyup:"value=value.replace(/[^\\d]/g,'')"},on:{blur:e.submitIp,input:function(t){return e.checkVal(t,"ip1")}},nativeOn:{keyup:function(t){return e.keyupEvent(1,t)}},model:{value:e.ip1,callback:function(t){e.ip1=t},expression:"ip1"}}),e._v(" "),i("span",[e._v(" - ")]),e._v(" "),i("el-input",{ref:"ip2",attrs:{size:"small",disabled:e.disabled,name:"ip",maxlength:"3",onkeyup:"value=value.replace(/[^\\d]/g,'')"},on:{blur:e.submitIp,input:function(t){return e.checkVal(t,"ip2")}},nativeOn:{keyup:function(t){return e.keyupEvent(2,t)}},model:{value:e.ip2,callback:function(t){e.ip2=t},expression:"ip2"}}),e._v(" "),i("span",[e._v("-")]),e._v(" "),i("el-input",{ref:"ip3",attrs:{size:"small",disabled:e.disabled,name:"ip",maxlength:"3",onkeyup:"value=value.replace(/[^\\d]/g,'')"},on:{blur:e.submitIp,input:function(t){return e.checkVal(t,"ip3")}},nativeOn:{keyup:function(t){return e.keyupEvent(3,t)}},model:{value:e.ip3,callback:function(t){e.ip3=t},expression:"ip3"}}),e._v(" "),i("span",[e._v("-")]),e._v(" "),i("el-input",{ref:"ip4",attrs:{size:"small",disabled:e.disabled,name:"ip",maxlength:"3",onkeyup:"value=value.replace(/[^\\d]/g,'')"},on:{blur:e.submitIp,input:function(t){return e.checkVal(t,"ip4")}},nativeOn:{keyup:function(t){return e.keyupEvent(4,t)}},model:{value:e.ip4,callback:function(t){e.ip4=t},expression:"ip4"}}),e._v(" "),e._t("default")],2)},staticRenderFns:[]};var l=i("VU/8")(n,r,!1,function(e){i("CHVe")},"data-v-7763beea",null).exports,u=i("DuOc"),o=i("PUuf"),p={name:"ipInput",data:function(){return{ip1:null,ip2:null,ip3:null,ip4:null}},props:["defaultIp","disabled"],created:function(){if(this.defaultIp){var e=this.defaultIp.split(":");this.ip1=e[0],this.ip2=e[1],this.ip3=e[2],this.ip4=e[3]}},methods:{clearValue:function(){this.ip1=null,this.ip2=null,this.ip3=null,this.ip4=null},submitIp:function(){if(this.ip1&&this.ip2&&this.ip3&&this.ip4){var e=this.ip1+":"+this.ip2+":"+this.ip3+":"+this.ip4;this.$emit("getIpVal",e),this.$parent.$emit("el.form.change")}},checkVal:function(e,t){if(i=e,new RegExp("([A-Fa-f0-9]{2}-){5}[A-Fa-f0-9]{2}").test(i)||(console.log("Mac地址格式不正确，请检查"),0))switch(t){case"ip1":this.focusInput(2);break;case"ip2":this.focusInput(3);break;case"ip3":this.focusInput(4)}var i},focusInput:function(e){switch(e){case"ip2":this.$refs.ip2.focus();break;case"ip3":this.$refs.ip3.focus();break;case"ip4":this.$refs.ip4.focus()}},keyupEvent:function(e,t){110===t.keyCode&&(1==e?this.$refs.ip2.focus():2==e?this.$refs.ip3.focus():3==e&&this.$refs.ip4.focus())}}},c={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"ip-box"},[i("el-input",{ref:"ip1",attrs:{name:"ip",maxlength:"3",onkeyup:"value=value.replace(/[A-F\\d]{2}/g,'')",disabled:e.disabled},on:{blur:e.submitIp,input:function(t){return e.checkVal(t,"ip1")}},nativeOn:{keyup:function(t){return e.keyupEvent(1,t)}},model:{value:e.ip1,callback:function(t){e.ip1=t},expression:"ip1"}}),e._v(" "),i("span",[e._v("-")]),e._v(" "),i("el-input",{ref:"ip2",attrs:{disabled:e.disabled,name:"ip",maxlength:"3",onkeyup:"value=value.replace(/[A-F\\d]{2}/g,'')"},on:{blur:e.submitIp,input:function(t){return e.checkVal(t,"ip2")}},nativeOn:{keyup:function(t){return e.keyupEvent(2,t)}},model:{value:e.ip2,callback:function(t){e.ip2=t},expression:"ip2"}}),e._v(" "),i("span",[e._v("-")]),e._v(" "),i("el-input",{ref:"ip3",attrs:{disabled:e.disabled,name:"ip",maxlength:"3",onkeyup:"value=value.replace(/[A-F\\d]{2}/g,'')"},on:{blur:e.submitIp,input:function(t){return e.checkVal(t,"ip3")}},nativeOn:{keyup:function(t){return e.keyupEvent(3,t)}},model:{value:e.ip3,callback:function(t){e.ip3=t},expression:"ip3"}}),e._v(" "),i("span",[e._v("-")]),e._v(" "),i("el-input",{ref:"ip4",attrs:{disabled:e.disabled,name:"ip",maxlength:"3",onkeyup:"value=value.replace(/[A-F\\d]{2}/g,'')"},on:{blur:e.submitIp,input:function(t){return e.checkVal(t,"ip4")}},nativeOn:{keyup:function(t){return e.keyupEvent(4,t)}},model:{value:e.ip4,callback:function(t){e.ip4=t},expression:"ip4"}}),e._v(" "),i("i",{staticClass:"el-icon-circle-close",on:{click:e.clearValue}})],1)},staticRenderFns:[]};var m={components:{ipViewVue:l,macViewVue:i("VU/8")(p,c,!1,function(e){i("ek/2")},"data-v-19d976a6",null).exports},data:function(){var e=function(e,t,i){""===t?i(new Error("请输入")):(/^((25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9])\.(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0)\.(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0)\.(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[0-9]))$/.test(t)||i(new Error("请输入正确的IP地址")),i())};return{isEdit:!1,changeVal:!0,optionsHhcp:[{label:"使用DHCP",value:!0},{label:"手动配置",value:!1}],DHCPChange:!1,option:[{name:"10Mbps"},{name:"15Mbps"},{name:"20Mbps"}],option1:[{name:"半双工"}],rules:{gateway:[{required:!0,validator:e,trigger:"change"}],ip:[{required:!0,validator:e,trigger:"change"}],netmask:[{required:!0,validator:e,trigger:"change"}],date2:[{type:"date",required:!0,message:"请选择时间",trigger:"change"}],type:[{type:"array",required:!0,message:"请至少选择一个活动性质",trigger:"change"}],resource:[{required:!0,message:"请选择活动资源",trigger:"change"}],desc:[{required:!0,message:"请填写活动形式",trigger:"blur"}]}}},props:["ruleForm","nameservers","type"],methods:{send:function(e){var t=this;console.log("data:",e),this.axios.post("/system/network/config",e).then(function(e){e&&e.data&&0==e.data.ret.code?t.$message("修改成功 !"):e&&e.data&&e.data.ret.cn&&t.$message(e.data.ret.cn)})},addBtn:function(){this.nameservers.length>2?this.$message("DNS最大能添加三个"):this.nameservers.push({value:""})},deleteBtn:function(e,t){this.nameservers.length>0&&this.nameservers.splice(t,1)},make2cidr:function(e){var t="",i=!0,a=!1,n=void 0;try{for(var r,l=s()(e.split("."));!(i=(r=l.next()).done);i=!0){var u=r.value;if(parseInt(u)>255)return this.$message("子网掩码错误"),!1;if(parseInt(u)>0&&parseInt(u)<128)return this.$message("子网掩码错误"),!1;t+=(u>>>0).toString(2)}}catch(e){a=!0,n=e}finally{try{!i&&l.return&&l.return()}finally{if(a)throw n}}return-1!==t.substring(t.search("0"),32).search("1")?(this.$message("子网掩码错误"),!1):t.split("1").length-1},cheangeEdit:function(){o.a.getWhiteList(this.baseUrl.host)?this.type=1:this.$message("只能在局域网修改网络设备!")},submitForm:function(e){var t=this;console.log("_this.ruleForm:",t.ruleForm);var i={},a=t.make2cidr(t.ruleForm.ipv4.netmask);if(!this.ruleSubmit())return!1;console.log("this.rule():",this.ruleSubmit()),a?(i[this.ruleForm.name]={ip:t.ruleForm.ipv4.ip,prefix:a,defaultGateway:t.ruleForm.defaultGateway,nameservers:t.nameservers,dhcp:!1},t.send(i)):this.$message("子网掩码错误!")},change:function(){this.DHCPChange=!0},ruleSubmit:function(){var e=/^((25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9])\.(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0)\.(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0)\.(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[0-9]))$/;return console.log("IP 地址:",e.test(this.ruleForm.ipv4.ip),this.ruleForm.ipv4.ip),!!e.test(this.ruleForm.ipv4.ip)||(this.$message("IP 不合格!"),!1)},changeSubmit:function(e){if(console.log("val:",e),this.ruleForm.dhcp4){var t={};t[this.ruleForm.name]={dhcp:!0},this.send(t)}else this.submitForm("ruleForm")},getIpVal:function(e,t){this.changeVal=!1,console.log("val:",e,t),"defaultGateway"==t?this.ruleForm.defaultGateway=e:this.ruleForm.ipv4[t]=e,this.ruleForm.ipv4[t]=e},getIpVal_:function(e,t){return this.changeVal=!1,this.nameservers[t]=e,console.log(" this.nameservers:",e),t},resetForm:function(e){u.a.$emit("refreshNetWork")}},mounted:function(){console.log("- network children--"),console.log("nameservers:",this.nameservers,this.ruleForm)}},d={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"formBody"},[i("ul",[1==e.type?i("li",[i("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm.ipv4,"label-width":"100px"}},[i("el-form-item",{staticStyle:{"margin-bottom":"25px"},attrs:{label:"配置IPv4",prop:"dhcp"}},[i("el-select",{attrs:{size:"small",placeholder:"请选择"},on:{change:e.change},model:{value:e.ruleForm.dhcp4,callback:function(t){e.$set(e.ruleForm,"dhcp4",t)},expression:"ruleForm.dhcp4"}},e._l(e.optionsHhcp,function(e){return i("el-option",{key:e.value,staticStyle:{padding:"6px 10px"},attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:!e.ruleForm.dhcp4,expression:"!ruleForm.dhcp4"}],staticClass:"submitFormat"},[i("el-form-item",{attrs:{label:"IP地址"}},[i("ip-viewVue",{attrs:{defaultIp:e.ruleForm.ipv4.ip,disabled:e.isEdit},on:{getIpVal:function(t){return e.getIpVal(t,"ip")}}})],1),e._v(" "),i("el-form-item",{attrs:{label:"子网掩码",prop:"netmask"}},[i("ip-viewVue",{attrs:{defaultIp:e.ruleForm.ipv4.netmask,disabled:e.isEdit},on:{getIpVal:function(t){return e.getIpVal(t,"netmask")}}})],1),e._v(" "),i("el-form-item",{attrs:{label:"网关地址",prop:"broadcast"}},[i("ip-viewVue",{attrs:{defaultIp:e.ruleForm.defaultGateway,disabled:e.isEdit},on:{getIpVal:function(t){return e.getIpVal(t,"defaultGateway")}}})],1),e._v(" "),e._l(e.nameservers,function(t,a){return i("div",{key:a},[i("el-form-item",{attrs:{label:"DNS"}},[i("ip-viewVue",{attrs:{attrs:"DNS",defaultIp:t,disabled:e.isEdit},on:{getIpVal:function(t){return e.getIpVal_(t,a)}},scopedSlots:e._u([{key:"default",fn:function(){return[i("el-button",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"delDns",attrs:{type:"primary",icon:"el-icon-delete",disabled:e.isEdit,size:"small"},on:{click:e.deleteBtn}},[e._v("删除")])]},proxy:!0}],null,!0)})],1)],1)}),e._v(" "),i("el-button",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"addDns",attrs:{type:"primary",icon:"el-icon-plus",disabled:e.isEdit,size:"small"},on:{click:e.addBtn}},[e._v("添加DNS")]),e._v(" "),i("el-form-item",[i("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.changeSubmit("ruleForm")}}},[e._v("应用")]),e._v(" "),i("el-button",{attrs:{size:"small"},on:{click:function(t){return e.resetForm("ruleForm")}}},[e._v("取消")])],1)],2),e._v(" "),i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.ruleForm.dhcp4,expression:"ruleForm.dhcp4"}],staticStyle:{"margin-top":"18px"}},[i("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.changeSubmit("ruleForm")}}},[e._v("应用")]),e._v(" "),i("el-button",{attrs:{size:"small"},on:{click:function(t){return e.resetForm("ruleForm")}}},[e._v("取消")])],1)],1)],1):e._e(),e._v(" "),0==e.type?i("li",[i("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,"label-width":"100px"}},[i("el-form-item",{staticStyle:{"margin-bottom":"15px","font-size":"16px"},attrs:{label:"当前模式",prop:"dhcp"}},[i("div",{staticClass:"onlyRead"},[e._v(e._s(e.ruleForm.dhcp4?"DHCP":"手动配置静态地址"))])]),e._v(" "),i("el-form-item",{attrs:{label:"IP地址"}},[i("div",{staticClass:"onlyRead"},[e._v(e._s(e.ruleForm.ipv4.ip))])]),e._v(" "),i("el-form-item",{attrs:{label:"子网掩码",prop:"netmask"}},[i("div",{staticClass:"onlyRead"},[e._v(e._s(e.ruleForm.ipv4.netmask))])]),e._v(" "),i("el-form-item",{attrs:{label:"网关地址",prop:"gateway"}},[i("div",{staticClass:"onlyRead"},[e._v(e._s(e.ruleForm.defaultGateway))])]),e._v(" "),e._l(e.nameservers,function(t,a){return i("div",{key:a},[i("el-form-item",{attrs:{label:"DNS"}},[i("div",{staticClass:"onlyRead"},[e._v(e._s(t))])])],1)}),e._v(" "),i("el-form-item",{staticStyle:{"margin-top":"15px"}},[i("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.cheangeEdit("ruleForm")}}},[e._v("修改")]),e._v(" "),i("el-button",{attrs:{size:"small"},on:{click:function(t){return e.resetForm("ruleForm")}}},[e._v("刷新")])],1)],2)],1):e._e()])])},staticRenderFns:[]};var f={components:{childrenWorkVue:i("VU/8")(m,d,!1,function(e){i("ilbE")},"data-v-0f88e7bc",null).exports},data:function(){return{list:[],type:0,nameservers:[]}},methods:{handleEdit:function(){},getData:function(){var e=this;self=this,this.axios.get("/system/network/config").then(function(t){if(console.log("list ==>",t),0==t.data.ret.code){e.list=[],e.nameservers=t.data.nameservers;var i=t.data.interfaces;for(var a in i)i[a].ipv4||(i[a].ipv4={}),i[a].nameLabel="网卡 "+a,i[a].name=a,i[a].ipv4.prefix?i[a].ipv4.netmask=self.cidr2netmask(i[a].ipv4.prefix):i[a].ipv4.netmask="",i[a].defaultGateway=t.data.defaultGateway||"",self.list.push(i[a])}})},cidr2netmask:function(e){for(var t=[],i=0;i<4;i++){var a=Math.min(e,8);t.push(256-Math.pow(2,8-a)),e-=a}return t.join(".")}},activated:function(){console.log("activated!!"),this.getData()},mounted:function(){var e=this;u.a.$on("refreshNetWork",function(){e.getData()}),u.a.$on("clickMenu",function(t){"/network"==t&&e.getData()}),console.log("get newwork:")}},h={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-row",[i("el-col",{attrs:{span:24}},[i("el-tabs",{staticStyle:{border:"solid 0px #ccc","box-shadow":"0px 0px 0px 0px"},attrs:{type:"border-card"}},e._l(e.list,function(t){return i("el-tab-pane",{key:t.name,staticStyle:{border:"0"},attrs:{label:t.nameLabel}},[i("children-workVue",{attrs:{type:e.type,nameservers:e.nameservers,ruleForm:t},on:{"update:type":function(t){e.type=t},"update:nameservers":function(t){e.nameservers=t}}})],1)}),1)],1)],1)},staticRenderFns:[]};var v=i("VU/8")(f,h,!1,function(e){i("cSAX")},"data-v-6ad3bb72",null);t.default=v.exports},CHVe:function(e,t){},cSAX:function(e,t){},"ek/2":function(e,t){},ilbE:function(e,t){}});